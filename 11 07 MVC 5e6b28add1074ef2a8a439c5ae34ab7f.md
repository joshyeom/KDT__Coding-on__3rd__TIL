# 11/07 MVC

Section: KDT 3rd
ì‘ì„±ì¼ì‹œ: 2022ë…„ 11ì›” 7ì¼ ì˜¤í›„ 9:07
ìµœì¢… í¸ì§‘ì¼ì‹œ: 2022ë…„ 11ì›” 8ì¼ ì˜¤í›„ 1:29

![1.png](/1107/1.png)

![2.png](/1107/2.png)

![3.png](/1107/3.png)

![4.png](/1107/4.png)

![5.png](/1107/5.png)

![6.png](/1107/6.png)

```jsx
const express = require("express");
const app = express();
const PORT = 8000;

app.set("view engine", "ejs");
app.use("/views", express.static(__dirname + "/views"));
app.use("/static", express.static(__dirname + "/static"));
app.use(express.urlencoded({ extended: true }));
app.use(express.json());

// MVC íŒ¨í„´ ì ìš©
// ./routes/index.js: indexëŠ” ìƒëµ ê°€ëŠ¥
const indexRouter = require("./routes");
// localhost:PORT/ ê²½ë¡œë¥¼ ê¸°ë³¸ìœ¼ë¡œ ./routes/index.js íŒŒì¼ì— ì„ ì–¸í•œ ëŒ€ë¡œ ë™ì‘
app.use("/", indexRouter);

// ./routes/user.js
const userRouter = require("./routes/user");
// localhost:PORT/user ê²½ë¡œë¥¼ ê¸°ë³¸ìœ¼ë¡œ ./routes/user.js íŒŒì¼ì— ì„ ì–¸í•œ ëŒ€ë¡œ ë™ì‘
app.use("/user", userRouter);

// [404 Error]
// (ì¤‘ìš”) ë§¨ ë§ˆì§€ë§‰ ë¼ìš°íŠ¸ë¡œ ì„ ì–¸
// ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ë‚˜ë¨¸ì§€ ì½”ë“œ ë¬´ì‹œë¨
// * : all
app.get("*", (req, res) => {
  res.render("404");
});

app.listen(PORT, () => {
  console.log(`http://localhost:${PORT}`);
});
```

# /views/comments.ejs

```html
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ëŒ“ê¸€ ëª©ë¡ ë³´ê¸°</title>
  </head>
  <body>
    <h1>ëŒ“ê¸€ ëª¨ìŒ</h1>
    <a href="/">í™ˆìœ¼ë¡œ ì´ë™í•˜ê¸°</a>

    <!-- ì „ì²´ ëŒ“ê¸€ ëª©ë¡ (4ê°œ) ë³´ì´ê¸° -->
    <ul>
      <% for (let i = 0; i < commentInfos.length; i++) { %>
      <li>
        <%= commentInfos[i].userid %> -
        <a href="/comment/<%= i+1 %>"><%= commentInfos[i].comment %></a>
        <!-- ë°°ì—´ì˜ 0ë²ˆì§¸ ìš”ì†Œ = commentInfos ìš”ì†Œì˜ id 1 -->
      </li>
      <% } %>
    </ul>
  </body>
</html>
```

![7.png](/1107/7.png)

```jsx
const express = require("express");
const controller = require("../controller/Cmain");
const router = express.Router();

// "ê²½ë¡œ ì„¤ì •" = ë¼ìš°íŒ…
// ê¸°ë³¸ ê²½ë¡œ: localhost:PORT/

// GET / => localhost:PORT/
router.get("/", controller.main);

// GET /comments => localhost:PORT/comments
router.get("/comments", controller.comments);

// GET /comment/:id => localhost:PORT/comment/:id
router.get("/comment/:id", controller.comment);

// module.exports ë¥¼ í†µí•´ì„œ router ë“±ë¡
// -> ë‹¤ë¥¸ íŒŒì¼ì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥
module.exports = router;
```

![10.png](/1107/10.png)

```jsx
const Comment = require("../model/Comment");

// const comments = [ {}, {}, {}, {} ];
exports.main = (req, res) => {
  res.render("index");
};

exports.comments = (req, res) => {
  // console.log(comments) // [ {}, {}, {}, {} ]
  console.log(Comment.commentInfos()); // ëŒ“ê¸€ ëª©ë¡ í™•ì¸ìš©: [ {}, {}, {}, {} ]
  // { commentInfos: [ {}, {}, {}, {} ]}
  res.render("comments", { commentInfos: Comment.commentInfos() });
};

exports.comment = (req, res) => {
  console.log(req.params); // ë¼ìš°íŠ¸ ë§¤ê°œë³€ìˆ˜(:id)ì— ëŒ€í•œ ì •ë³´ ë‹´ê²¨ìˆìŒ
  console.log(req.params.id); // id ê°’ ì¶”ì¶œ

  const comments = Comment.commentInfos(); // ëŒ“ê¸€ ëª©ë¡ í™•ì¸ìš©: [ {}, {}, {}, {} ]
  const commentId = req.params.id; // ëŒ“ê¸€ id: urlë¡œ ë“¤ì–´ì˜¨ ë§¤ê°œë³€ìˆ˜
  console.log(comments[commentId - 1]); // ëŒ“ê¸€ ëª©ë¡ì—ì„œ íŠ¹ì • ëŒ“ê¸€ ì •ë³´ ì¶”ì¶œ

  if (commentId < 1 || commentId > comments.length) {
    return res.render("404");
  }

  if (isNaN(commentId)) {
    return res.render("404");
  }

  res.render("comment", { commentInfo: comments[commentId - 1] });
};
```

![11.png](/1107/11.png)

```jsx
// (ì„ì‹œ) DBë¡œë¶€í„° ëŒ“ê¸€ ëª©ë¡ì„ ë°›ì•„ì˜´
// ë°°ì—´: ì „ì²´ ëŒ“ê¸€
// ê° ê°ì²´: ëŒ“ê¸€ í•˜ë‚˜
exports.commentInfos = () => {
  return [
    {
      id: 1,
      userid: "helloworld",
      date: "2022-10-31",
      comment: "ì•ˆë…•í•˜ì„¸ìš”^~^",
    },
    {
      id: 2,
      userid: "happy",
      date: "2022-11-01",
      comment: "ë°˜ê°€ì›Œìœ ",
    },
    {
      id: 3,
      userid: "lucky",
      date: "2022-11-02",
      comment: "ì˜¤ ì‹ ê¸°í•˜êµ°",
    },
    {
      id: 4,
      userid: "bestpart",
      date: "2022-11-02",
      comment: "ì²« ëŒ“ê¸€ì…ë‹ˆë‹¹ã…ã…",
    },
  ];
};
```

![12.png](/1107/12.png)

![8.png](/1107/8.png)

![9.png](/1107/9.png)

```jsx
// [404 Error]
// (ì¤‘ìš”) ë§¨ ë§ˆì§€ë§‰ ë¼ìš°íŠ¸ë¡œ ì„ ì–¸
// ê·¸ë ‡ì§€ ì•Šìœ¼ë©´ ë‚˜ë¨¸ì§€ ì½”ë“œ ë¬´ì‹œë¨
// * : all
app.get("*", (req, res) => {
  res.render("404");
});
```

# /views/404.ejs

```html
<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>404 Error</title>
  </head>
  <body>
    <h1>ğŸš¨404 Error</h1>
    <p>ì£„ì†¡í•©ë‹ˆë‹¤. í•´ë‹¹ URLì€ ì ‘ê·¼í•  ìˆ˜ ì—†ëŠ” ì£¼ì†Œì…ë‹ˆë‹¤.</p>
    <a href="/">HOME</a>
  </body>
</html>
```

# ì‹¬í™”

```jsx

```
